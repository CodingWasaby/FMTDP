function toLogin(){try{window.opener.location.href="/Login/Index"}catch(n){window.location.href="/Login/Index"}}function toIndex(){window.location.href="/Home/Index"}function reloadAllframes(){for(var n=0;n<self.frames.length;n++)self.frames[n].document.location.reload()}function MessageShow(n,t,i,r){swal({title:n,text:t,type:i,confirmButtonColor:"#1ab394",confirmButtonText:"确定",closeOnConfirm:!0},r)}function initCheckBox(n,t,i,r){var u,f,e;return u=i==="spatial"?sd:i==="time"?td:ad,f=document.querySelector(n),e=new Switchery(f,{color:t,size:"small",className:"switchery rateleft-my"}),f.onchange=function(){if(f.checked){e.disable();for(var n=0;n<u.length;n++)u[n].element.id!==f.id&&(u[n].enable(),u[n].element.checked&&u[n].element.click());r&&r()}},e}function spatialDim(n,t,i){var r=initCheckBox(n,"#1Aa394","spatial",t);return i&&r.disable(),r}function timeDim(n,t,i){var r=initCheckBox(n,"#7c8bc7","time",t);return i&&r.disable(),r}function arangeType(n,t,i){var r=initCheckBox(n,"#ff6a00","dataType",t);return i&&r.disable(),r}function loginSumbit(){validateInput()&&(swal({title:"正在验证...",text:"",confirmButtonColor:"#1ab394",confirmButtonText:"确定"}),$.ajax({url:"/Login/LoginSumbit",type:"POST",data:{userName:$("#userName").val(),password:$("#password").val()},traditional:!0,success:function(n){n==="true"?MessageShow("登陆成功","欢迎登陆FSS系统","success",toIndex):MessageShow("验证失败",n,"error")}}))}function loginOut(){$.ajax({url:"/Login/LoginOut",type:"POST",data:{userID:$("#userid").val()},traditional:!0,success:function(){toLogin()},error:function(){toLogin()}})}function sendMail_Rgister(){validateInput()&&(swal({title:"正在验证...",text:"",confirmButtonColor:"#1ab394",confirmButtonText:"确定"}),$.ajax({url:"/Login/RegisteSumbit",type:"POST",data:{userName:$("#userName").val(),password:$("#password").val()},traditional:!0,success:function(n){n==="true"?MessageShow("验证成功","审核通过后会发送邮件至您的工作邮箱。","success"):MessageShow("验证失败",n,"error")}}))}function validateInput(){for(var t=$("[required='required']"),n=0;n<t.length;n++)if(t[n].parentElement.setAttribute("class","form-group"),t[n].textLength===0)return t[n].parentElement.setAttribute("class","form-group has-error"),!1;return!0}function onSearchClick(){var t=$("#cinemaCode").val(),i=$("#cinemaName").val(),r=$("#city").val(),u=$("#regional").val(),f=$("#system").val(),e=$("#cinemaLine").val(),n="/Cinema?";t.length>0&&(n+="cinemaCode="+t+"&");i.length>0&&(n+="cinemaName="+i+"&");r.length>0&&(n+="city="+r+"&");u.length>0&&(n+="regional="+u+"&");f.length>0&&(n+="system="+f+"&");e.length>0&&(n+="cinemaLine="+e+"");window.location.href=n}function planTypeViewReady(){initChart(yqData,"yqchart");initChart(tpData,"tpchart");initChart(ccData,"ccchart");initChart(qdData,"qdchart");$(".ibox-content").each(function(){var n=$(this).children()[1].scrollHeight;$(this).height(n+20)})}function initChart(n,t){for(var u,r=[],i=0;i<n.length;i++)u=[n[i].name,n[i].value],r.push(u);c3.generate({bindto:"#"+t,data:{columns:r,type:"pie"},color:{pattern:["#dedede","#56e514","#1ab394","#1C84C6"]}})}function propertyViewReady(){initBar(cityInfo,"#cityInfo");initBar(regionalInfo,"#regionalInfo");initBar(customeSourceInfo,"#customerInfo");initBar(systemInfo,"#systemInfo");initSalesBar(saleAssistantInfo)}function initBar(n,t){for(var r,u,f=[],i=0;i<n.barDatas.length;i++){for(r=[],r.push(n.barDatas[i].dataName),u=0;u<n.barDatas[i].dataDetail.length;u++)r.push(n.barDatas[i].dataDetail[u]);f.push(r)}c3.generate({bindto:t,data:{columns:f,colors:{"贴片":"#56e514","映前":"#1ab394","渠道":"#1C84C6","场次":"#BABABA","时长总计":"#7c8bc7"},type:"bar",groups:[n.group,["时长总计"]],axes:{"贴片":"y","映前":"y","渠道":"y","场次":"y","时长总计":"y2"}},axis:{x:{type:"category",categories:n.categories},y:{label:{text:"方案数量",position:"outer-middle"}},y2:{show:!0,label:{text:"投放总时长（秒）"}}}})}function initSalesBar(n){for(var i,r,u=[],t=0;t<n.barDatas.length;t++){for(i=[],i.push(n.barDatas[t].dataName),r=0;r<n.barDatas[t].dataDetail.length;r++)i.push(n.barDatas[t].dataDetail[r]);u.push(i)}c3.generate({bindto:"#saleassitentInfo",size:{height:$(".row").height()-108},data:{columns:u,colors:{"贴片":"#56e514","映前":"#1ab394","渠道":"#1C84C6","场次":"#BABABA","时长总计":"#7c8bc7"},type:"bar",groups:[n.group,["时长总计"]],axes:{"贴片":"y","映前":"y","渠道":"y","场次":"y","时长总计":"y2"}},axis:{rotated:!0,x:{type:"category",categories:n.categories},y:{label:{text:"方案数量",position:"outer-middle"}},y2:{show:!0,label:{text:"投放总时长（秒）"},tick:{values:[0,5e4,2e5,5e5]}}},oninit:function(){var n=$("#salescon").height($("#saleassitentInfo").height())}})}function rateTrendReady(){sd.push(spatialDim("#cinema",paramChange,!0));sd.push(spatialDim("#city",paramChange));sd.push(spatialDim("#regional",paramChange));sd.push(spatialDim("#system",paramChange));td.push(timeDim("#task",paramChange,!0));td.push(timeDim("#month",paramChange));initLine(lines,"#rateInfo");$("#dataRange").select2();$("#dataRange").on("select2:select",function(){paramChange(!0)})}function paramChange(n){$.ajax({url:"/Confirm/GetRateByDim",async:!0,type:"POST",data:{spatialDim:$(".spatial:checked")[0].id,timeDim:$(".time:checked")[0].id,pages:n?$("#dataRange").val():""},traditional:!0,success:function(t){initLine(t,"#rateInfo");n||resetSelect(t.pageInfo,"#dataRange")}})}function resetSelect(n,t){var i,r,u;for($(t).select2("destroy"),$(t).children().remove(),i=0;i<n.length;i++)r={id:n[i].item1+"-"+n[i].item2,text:n[i].item1+"-"+n[i].item2},u=new Option(r.text,r.id,!1,!1),$("#dataRange").append(u).trigger("change");$(t).select2()}function initLine(n,t){for(var r,u,f=[],i=0;i<n.lines.length;i++){for(r=[],r.push(n.lines[i].lineName),u=0;u<n.lines[i].datas.length;u++)r.push(n.lines[i].datas[u]);f.push(r)}c3.generate({size:{height:$(".gray-bg").height()*.75},bindto:t,data:{columns:f,type:"area-spline"},axis:{x:{type:"category",categories:n.categories},y:{label:{text:"预计上刊率"}}},oninit:function(){$(".ibox-content").each(function(){var n=$(this).children()[1].scrollHeight;$(this).height(n+20)})}})}function ArrangeReady(){sd.push(spatialDim("#cinema",paramChange_Arrange,!0));sd.push(spatialDim("#city",paramChange_Arrange));sd.push(spatialDim("#regional",paramChange_Arrange));sd.push(spatialDim("#system",paramChange_Arrange));td.push(timeDim("#task",paramChange_Arrange,!0));td.push(timeDim("#month",paramChange_Arrange));ad.push(arangeType("#YQ",paramChange_Arrange));ad.push(arangeType("#YQ_CC",paramChange_Arrange));ad.push(arangeType("#YQ_CC_TP",paramChange_Arrange));initLine_Arrange(lines,"#rateInfo");$("#dataRange").select2();$("#dataRange").on("select2:select",function(){paramChange_Arrange(!0)})}function paramChange_Arrange(n){$.ajax({url:"/Arrange/GetRateByDim",async:!0,type:"POST",data:{spatialDim:$(".spatial:checked")[0].id,timeDim:$(".time:checked")[0].id,arrangeRateType:$(".dataType:checked")[0].id,pages:n?$("#dataRange").val():""},traditional:!0,success:function(t){initLine_Arrange(t,"#rateInfo");n||resetSelect(t.pageInfo,"#dataRange")}})}function initLine_Arrange(n,t){var f,i,r,u;for(console.log(n),f=[],i=0;i<n.lines.length;i++){for(r=[],r.push(n.lines[i].lineName),u=0;u<n.lines[i].datas.length;u++)r.push(n.lines[i].datas[u]);f.push(r)}c3.generate({size:{height:$(".gray-bg").height()*.75},bindto:t,data:{columns:f,type:"area-spline"},axis:{x:{type:"category",categories:n.categories},y:{label:{text:"上刊率统计"}}},oninit:function(){$(".ibox-content").each(function(){var n=$(this).children()[1].scrollHeight;$(this).height(n+20)})}})}window.onkeydown=function(n){n=n?n:window.event;n.keyCode&&n.keyCode===13&&$("#sumbit").click()};